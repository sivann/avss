<html>
<head>
<title>
ShoutClub - Viewing Article #17 - The Streaming Standard by Jay Krivanek</title>
<body>
		<font face="Arial" size="2"><b>ShoutClub.com</b> Article Number 17, <i>"The Streaming Standard"</i> by <b>Jay Krivanek</b><br><br><font face="arial" size="2"><font face="arial" size="2" color="#78D691"><b>Intro</b></font><br>Not much is available about how our streaming technology works, more specifically MP3 streaming.  When you get right down to it, it is actually very simple to understand.  You will especially understand it if you know anything about HTTP's Protocal, which is simply a communication method for a client to a server.  This article is mainly geared for those hard core into this stuff or those who want to develop applications similar to those utilized at this site.<br><br><font face="arial" size="2" color="#78D691"><b>Tools used</b></font><br>The tools used for streaming are quite simple:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Source (usually a dsp in a player)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Server (dispatches the source's mp3 stream to the client)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Client (is used to listen to the audio coming down from the server.<br><br><font face="arial" size="2" color="#78D691"><b>Source to Server</b></font><br>In order for a server to allow connections from a client, it needs a source.  When a source connection is made then the server will pass the data along to the clients when they connect.<br><br>The dialog goes something like this (I will use SHOUTcast as the example)<br><br>1. The source makes a connection to the service port (shoutcast's is the port +1)<br>2. The source then sends the password like so <i>password\r\n</i><br>3. If the password is correct, the server will reply with <i>OK2\r\nicy-caps:11\r\n\r\n</i>, this basically informs the source that the server has authorized the dsp to be the source and it is ready for data.  If the password is incorrect, the server sends <i>invalid password\r\n</i>.<br>4. If the source recieves the OK2, it then begins sending information about the stream to the server.  Usually in this form:<br><br><i>icy-name:Unnamed Server\r\nicy-genre:Unknown Genre\r\nicy-pub:1\r\nicy-br:56\r\nicy-url:http://www.shoutcast.com\r\nicy-irc:%23shoutcast\r\nicy-icq:0\r\nicy-aim:N%2FA\r\n\r\n</i><br><br>Then The source will begin sending the mp3 encoded stream<br>* icy-name is the name of the stations<br>* icy-genre is the genre that the station resides in<br>* icy-pub is basically a switch to either allow the server to publish itself in the directory or not (1 meaning yes and 0 meaning no)<br>* icy-br is the bitrate of the stream<br>* icy-url is the homepage for the stream<br>* icy-irc is yp shoutcast specific (used for contact information)<br>* icy-icq is yp shoutcast specific (used for contact information)<br>* icy-aim is yp shoutcast specific (used for contact information)<br><br>This is just a simple walk through of how the source communicates with the server.  No other information is passed on this port as far as I am aware.<br><br>SHOUTcast specific Title streaming:<br>This is a simple one, the server recieves the title of the song and the URL of the page simply by having the source make the URL call http://www.host.com:portnumber/admin.cgi?pass=Server%20Password&mode=updinfo&song=Song%20Goes%20here&url=http://someurl.com<br><br>When this gets called by the source or a browser even, the title of the song changes in the clients witch support shoutcast style title streaming.  This communication always happens on the public port (defaultly 8000) never on the service port as it is used for strictly sending the stream to the server.<br><br><font face="arial" size="2" color="#78D691"><b>Client to Server</b></font><br>The Client to Server communication is handle in a similar fashion to the way that a browser communicates with a webpage server.  This is known as the HTTP protocal.  However SHOUTcast and icecast do not handle in exactly the same manner, the headers are different.  I have yet to pin point exactly what is so different.  I think it may have something to do with the notification error, as it is HTTP/1.0 200 OK on all webservers using HTTP, this may confuse some clients and causes the headers to not exist.<br>1.  The client connects to the server and sends information about itself, if it can handle title streaming it sends and extra field like so:<br><i>icy-metadata:1\r\n</i><br>In addition to the normal headers sent.  This tag signifies that the client has the ability to stream the title streaming tags from the stream, therefore the server will send the extra title information, if this were not possible, some clients would hiccup when the title information is sent<br>2. The server then responds with<br><br><i>ICY 200 OK\r\n</i>  (signifying that the server was successful)<br><i>icy-notice1:{BR}This stream requires {a href="http://www.winamp.com/"}Winamp{/a}{BR}</i> (redundant notice)<br><i>icy-notice2:SHOUTcast Distributed Network Audio Server/posix v1.8.0{BR}</i> (tells the client what server it is and version)  SHOUTcast Specific<br><i>icy-name:Unnamed Server\r\n</i> (Name of the server)<br><i>icy-genre:Unknown Genre\r\n</i> (what genre the server falls under)<br><i>icy-url:http://www.shoutcast.com\r\n</i> (homepage for the server)<br><i>icy-pub:1\r\n</i> (whether the server is public or not)<br><i>icy-br:56\r\n</i> (bitrate of the server)<br><i>icy-metaint:8192\r\n</i> (if icy-metadata:1 was signified this was shown I will discuss this further later)<br><i>\r\n</i> (end of header)<br><br>3. At this point the server begins sending the audio data.<br><br><font face="arial" size="2" color="#78D691"><b>SHOUTcast Title Streaming at a glance</b></font><br>Earlier we discussed how the server gets the title of the song from the source, but we didn't quite get into how the client gets the title of the song.<br><br>When the client signifies that it is title streaming compatible, the shoutcast server adds an extra header tag set like so<br><i>icy-metaint:8192\r\n</i><br>this tells the client exactly how many bytes of data to read out of the stream before it can expect the beginning of the Meta-Data (which is where the title is stored)  It also always starts counting at the beginning of the stream (not the header)<br>After this the client then reads 1 byte, this byte tells the client how large the Meta-Data Tag is divided by 16, so if the byte was 4 then the client would know that the meta-data tag was 64 bytes long.  But, you ask, not all titles are going to equal 64 byets or 48 bytes etc...?  Well the simple answer is that SHOUTcast places blanks or "\0" in the unused space untile it equals the length, after that is read, then it is back to the mpeg data to start the process all over again.<br><br>Pretty simple huh?<br><br><font face="arial" size="2" color="#78D691"><b>In Closing</b></font><br>I am sure that this technology will change, and I will try my best to keep this article up to the specs as I know them.  If you find anything incorrect in this article, or any oversights, then please email me at <a href="admin@shoutclub.com">admin@shoutclub.com</a>.</font><p><table width="90%" border="1" cellspacing="0" cellpadding="1" bordercolor="#848400" bordercolorlight="#78D691" bordercolordark="#006363" align="center">
<tr>
  <td bgcolor="#006363">
    <font face="Arial" size="2" align="bottom"><b>Comments:</b>
  </td>
</tr><tr><td bgcolor="#006363" align="bottom"><font face="Arial" size=1>ryan &nbsp;&nbsp;<a href="mailto:rambler@rambler.yi.org"><img src="http://www.shoutclub.com/articles/images/email.gif" width="14" hieght="11" border="0" alt="Email ryan"></a> &nbsp;&nbsp;Submitted on August 24th, 2001 (06:32 PM)GMT</font></td></tr><tr><td><font face="Arial" size=2 align="bottom">Thanks for the info, I made a script in perl to serv my mp3's through http, and I needed the info on this page to send the song title.</font></td></tr><tr><td bgcolor="#006363" align="bottom"><font face="Arial" size=1>shadows &nbsp;&nbsp;<a href="mailto:rambler@rambler.yi.org"><img src="http://www.shoutclub.com/articles/images/email.gif" width="14" hieght="11" border="0" alt="Email ryan"></a> &nbsp;&nbsp;Submitted on October 26th, 2001 (09:32 AM)GMT</font></td></tr><tr><td><font face="Arial" size=2 align="bottom">not much, though thank you for the hints<br>
 :-)<br>
there are not many spots to pump the info from.<br>
still, if you know more specs I would like to have you share the knowledge with us all.<br>
<br>
Thank you once more.</font></td></tr></table>&nbsp;</font>
<table width="70%" border="1" cellspacing="0" cellpadding="1" bordercolor="#848400" bordercolorlight="#78D691" bordercolordark="#006363" align="center">
<tr>
  <td bgcolor="#006363">
    <font face="Arial" size="2"><b>Add a Comment:</b>
  </td>
</tr>
<tr>
  <td><form method=Post action="http://www.shoutclub.com/articles/view.php3"><font face="Arial" size="2">
<input type=hidden name=num value="17">
<b>Your name:</b> <input type=text name=newname size="40"><br>
<b>Your email:</b> <input type=text name=newemail size="40"><br>
<b>Your comment:</b><br>
<center><TEXTAREA NAME="newcomment" ROWS=10 COLS=45 WRAP="VIRTUAL"></TEXTAREA></center><br>
<p align=right><input type=submit name="commit" value="Add Comment"></p>
  </td>
</tr>
</table>&nbsp;</body></html>